datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // uncomment next line if you use Prisma <5.10
  // directUrl = env("DATABASE_URL_UNPOOLED")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

model Product {
  id          Int          @id @default(autoincrement())
  name        String
  category    String
  pricePerKgCompra Float?
  pricePerKgVenda  Float?
  stock       Float 
  itensCompra ItemCompra[]
  itensVenda  ItemVenda[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Client {
  id        Int      @id @default(autoincrement())
  name      String
  idade     Int
  email     String
  telefone  String
  cpf       String
  vendas    Venda[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Compra {
  id           Int          @id @default(autoincrement())
  fornecedorId Int
  dataCompra   DateTime     @default(now())
  totalItens   Int          @default(0)
  pesoTotal    Decimal      @default(0.00)
  valorTotal   Decimal      @default(0.00)
  fornecedor   Fornecedor   @relation(fields: [fornecedorId], references: [id])
  itens        ItemCompra[]

  @@map("compras")
}

model ItemCompra {
  id        Int     @id @default(autoincrement())
  compraId  Int
  produtoId Int
  peso      Decimal
  precoKg   Decimal
  subtotal  Decimal @default(0.00)
  compra    Compra  @relation(fields: [compraId], references: [id], onDelete: Cascade)
  produto   Product @relation(fields: [produtoId], references: [id])

  @@map("itens_compra")
}

model Venda {
  id          Int        @id @default(autoincrement())
  clientId    Int
  dataVenda   DateTime   @default(now())
  totalItens  Int        @default(0)
  pesoTotal   Decimal    @default(0.00)
  valorTotal  Decimal    @default(0.00)

  client      Client     @relation(fields: [clientId], references: [id])
  itens       ItemVenda[] // relação correta com ItemVenda

  @@map("vendas")
}

model ItemVenda {
  id          Int      @id @default(autoincrement())
  vendaId     Int
  produtoId   Int
  peso        Decimal
  precoKg     Decimal
  subtotal    Decimal   @default(0.00)

  venda       Venda     @relation(fields: [vendaId], references: [id], onDelete: Cascade)
  produto     Product   @relation(fields: [produtoId], references: [id])

  @@map("itens_venda")
}

model Fornecedor {
  id        Int      @id @default(autoincrement())
  name      String
  email     String?
  telefone  String?
  compras   Compra[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("fornecedores")
}
